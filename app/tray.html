<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Hippius Tray</title>
    <style>
        body {
            background-color: #FF0000;
            /* Bright red background */
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            text-align: center;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .status {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            background-color: white;
            color: black;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>HIPPIUS STATUS</h1>

    <div class="status" id="sync-status">Initializing...</div>

    <div class="buttons">
        <button id="show-main-btn">Show Main</button>
        <button id="quit-btn">Quit</button>
    </div>

    <div id="debug"
        style="margin-top: 20px; text-align: left; background: black; color: lime; padding: 10px; font-family: monospace;">
        Window loaded at: <script>
            document.write(new Date().toISOString())
        </script>
    </div>

    <script>
        // Log function
        function log(msg) {
            const debug = document.getElementById('debug');
            debug.innerHTML += "<br>" + new Date().toISOString() + ": " + msg;
        }

        log("Script started");

        try {
            log("Accessing Tauri APIs");
            const {
                invoke
            } = window.__TAURI__.core;
            const {
                listen
            } = window.__TAURI__.event;

            log("Setting up button handlers");
            document.getElementById('show-main-btn').addEventListener('click', () => {
                log("Show Main button clicked");
                invoke('toggle_main_window').catch(e => log("Error: " + e));
            });

            document.getElementById('quit-btn').addEventListener('click', () => {
                log("Quit button clicked");
                invoke('quit_app').catch(e => log("Error: " + e));
            });

            log("Setting up event listeners");
            listen('sync-update', (event) => {
                log("Sync update received: " + JSON.stringify(event.payload));

                const data = event.payload;
                const statusElement = document.getElementById('sync-status');

                if (data.status === 'completed') {
                    statusElement.textContent = 'Sync Complete!';
                    statusElement.style.backgroundColor = '#4CAF50';
                } else if (data.status === 'syncing') {
                    statusElement.textContent = `Syncing ${data.percent}%`;
                    statusElement.style.backgroundColor = '#FF9800';
                } else {
                    statusElement.textContent = 'Idle';
                    statusElement.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
                }
            });

            log("Setup complete");
        } catch (e) {
            log("Error in setup: " + e.toString());
        }
    </script>
</body>

</html>